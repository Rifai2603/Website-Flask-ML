{% extends "base.html" %}
{% block content %}

<div class="container">
    <div class="row mt-4">
        <div class="col-md-12">
            <h1 class="section-title">Hasil Analisis RSRP</h1>
            <p class="text-center subtitle">Site ID: {{ site_id }} - {{ alamat_site }}</p>
            <p class="alert alert-info">{{ ringkasan }}</p>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title text-center">RSRP</h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h4 class="text-center">Sebelum Optimasi</h4>
                            <div class="map-container">
                                <iframe src="{{ url_for('static', filename='maps/rsrp_before_' + analysis_id + '.html') }}" width="100%" height="400"></iframe>
                            </div>
                            <div class="table-responsive mt-3">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Kategori</th>
                                            <th>Batas Nilai RSRP (dBm)</th>
                                            <th>Jumlah Titik</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="table-primary">
                                            <td>Sangat Bagus</td>
                                            <td>≥ -85</td>
                                            <td>{{ rsrp_stats.before.sangat_bagus }}</td>
                                        </tr>
                                        <tr class="table-success">
                                            <td>Bagus</td>
                                            <td>≥ -95 s/d -85</td>
                                            <td>{{ rsrp_stats.before.bagus }}</td>
                                        </tr>
                                        <tr class="table-normal">
                                            <td>Normal</td>
                                            <td>≥ -100 s/d -95</td>
                                            <td>{{ rsrp_stats.before.normal }}</td>
                                        </tr>
                                        <tr class="table-warning">
                                            <td>Buruk</td>
                                            <td>≥ -105 s/d -100</td>
                                            <td>{{ rsrp_stats.before.buruk }}</td>
                                        </tr>
                                        <tr class="table-danger">
                                            <td>Sangat Buruk</td>
                                            <td>≥ -150 s/d -105</td>
                                            <td>{{ rsrp_stats.before.sangat_buruk }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="chart-container mt-3">
                                <canvas id="rsrpChartBefore"></canvas>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h4 class="text-center">Setelah Optimasi</h4>
                            <div class="map-container">
                                <iframe src="{{ url_for('static', filename='maps/rsrp_after_' + analysis_id + '.html') }}" width="100%" height="400"></iframe>
                            </div>
                            <div class="table-responsive mt-3">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Kategori</th>
                                            <th>Batas Nilai RSRP (dBm)</th>
                                            <th>Jumlah Titik</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="table-primary">
                                            <td>Sangat Bagus</td>
                                            <td>≥ -85</td>
                                            <td>{{ rsrp_stats.after.sangat_bagus }}</td>
                                        </tr>
                                        <tr class="table-success">
                                            <td>Bagus</td>
                                            <td>≥ -95 s/d -85</td>
                                            <td>{{ rsrp_stats.after.bagus }}</td>
                                        </tr>
                                        <tr class="table-normal">
                                            <td>Normal</td>
                                            <td>≥ -100 s/d -95</td>
                                            <td>{{ rsrp_stats.after.normal }}</td>
                                        </tr>
                                        <tr class="table-warning">
                                            <td>Buruk</td>
                                            <td>≥ -105 s/d -100</td>
                                            <td>{{ rsrp_stats.after.buruk }}</td>
                                        </tr>
                                        <tr class="table-danger">
                                            <td>Sangat Buruk</td>
                                            <td>≥ -150 s/d -105</td>
                                            <td>{{ rsrp_stats.after.sangat_buruk }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="chart-container mt-3">
                                <canvas id="rsrpChartAfter"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Chart untuk RSRP Sebelum Optimasi
    const ctxBefore = document.getElementById('rsrpChartBefore').getContext('2d');
    const rsrpChartBefore = new Chart(ctxBefore, {
        type: 'pie',
        data: {
            labels: ['Sangat Bagus', 'Bagus', 'Normal', 'Buruk', 'Sangat Buruk'],
            datasets: [{
                data: [
                    {{ rsrp_stats.before.sangat_bagus }}, 
                    {{ rsrp_stats.before.bagus }}, 
                    {{ rsrp_stats.before.normal }}, 
                    {{ rsrp_stats.before.buruk }}, 
                    {{ rsrp_stats.before.sangat_buruk }}
                ],
                backgroundColor: [
                    '#0d6efd', // Biru untuk Sangat Bagus
                    '#198754', // Hijau untuk Bagus
                    '#b6db8f', // Hijau Muda untuk Normal
                    '#FFFF00', // Kuning untuk Buruk
                    '#dc3545'  // Merah untuk Sangat Buruk
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                }
            }
        }
    });

    // Chart untuk RSRP Setelah Optimasi
    const ctxAfter = document.getElementById('rsrpChartAfter').getContext('2d');
    const rsrpChartAfter = new Chart(ctxAfter, {
        type: 'pie',
        data: {
            labels: ['Sangat Bagus', 'Bagus', 'Normal', 'Buruk', 'Sangat Buruk'],
            datasets: [{
                data: [
                    {{ rsrp_stats.after.sangat_bagus }}, 
                    {{ rsrp_stats.after.bagus }}, 
                    {{ rsrp_stats.after.normal }}, 
                    {{ rsrp_stats.after.buruk }}, 
                    {{ rsrp_stats.after.sangat_buruk }}
                ],
                backgroundColor: [
                    '#0d6efd', // Biru untuk Sangat Bagus
                    '#198754', // Hijau untuk Bagus
                    '#b6db8f', // Hijau Muda untuk Normal
                    '#FFFF00', // Kuning untuk Buruk
                    '#dc3545'  // Merah untuk Sangat Buruk
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                }
            }
        }
    });
</script>

{% endblock %}